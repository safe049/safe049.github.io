<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>AI on Dysprosium</title>
    <link>https://safe049.github.io/tags/ai/</link>
    <description>Recent content in AI on Dysprosium</description>
    <generator>Hugo</generator>
    <language>zh</language>
    <lastBuildDate>Wed, 19 Feb 2025 20:49:18 +0800</lastBuildDate>
    <atom:link href="https://safe049.github.io/tags/ai/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Colab Unsloth SFT 快速训练！</title>
      <link>https://safe049.github.io/post/colabunsloth/</link>
      <pubDate>Wed, 19 Feb 2025 20:49:18 +0800</pubDate>
      <guid>https://safe049.github.io/post/colabunsloth/</guid>
      <description>&lt;h1 id=&#34;序言&#34;&gt;序言&lt;/h1&gt;&#xA;&lt;p&gt;大部分人的GPU都没有训练AI的显存要求，而谷歌Colab完全可以解决这一点&lt;/p&gt;&#xA;&lt;p&gt;谷歌Colab可以让你免费使用谷歌的服务器4个小时左右来进行训练&lt;/p&gt;&#xA;&lt;p&gt;并且是一个Jupyter Notebook环境&lt;/p&gt;&#xA;&lt;p&gt;这是它的地址： &lt;a href=&#34;https://colab.research.google.com/&#34;&gt;https://colab.research.google.com/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;这是Unsloth的训练笔记本： &lt;a href=&#34;https://colab.research.google.com/drive/1Ys44kVvmeZtnICzWz0xgpRnrIOjZAuxp&#34;&gt;https://colab.research.google.com/drive/1Ys44kVvmeZtnICzWz0xgpRnrIOjZAuxp&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;准备工作&#34;&gt;准备工作&lt;/h1&gt;&#xA;&lt;p&gt;谷歌Colab可以直接通过谷歌账号登录&lt;/p&gt;&#xA;&lt;p&gt;登录完毕后就可以开始了&lt;/p&gt;&#xA;&lt;h2 id=&#34;修改代码&#34;&gt;修改代码&lt;/h2&gt;&#xA;&lt;p&gt;首先先不要急着运行运行时，先修改一下笔记本的代码&lt;/p&gt;&#xA;&lt;h3 id=&#34;模型下载&#34;&gt;模型下载&lt;/h3&gt;&#xA;&lt;p&gt;首先，修改第二个代码框的这一部分：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;model, tokenizer &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FastLanguageModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    model_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;unsloth/Meta-Llama-3.1-8B&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#75715e&#34;&gt;# 修改这里&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    max_seq_length &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; max_seq_length,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    dtype &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dtype,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    load_in_4bit &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; load_in_4bit,&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# token = &amp;#34;hf_...&amp;#34;, # use one if using gated models like meta-llama/Llama-2-7b-hf&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;将需要修改的部分修改为你要使用的模型，可以直接使用Hugging Face库名&lt;/p&gt;&#xA;&lt;h3 id=&#34;数据集准备&#34;&gt;数据集准备&lt;/h3&gt;&#xA;&lt;p&gt;前往笔记本中的 &lt;code&gt;Data Prep&lt;/code&gt; 部分，修改代码&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;formatting_prompts_func&lt;/span&gt;(examples):&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    instructions &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; examples[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;instruction&amp;#34;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    inputs       &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; examples[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;input&amp;#34;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    outputs      &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; examples[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;output&amp;#34;&lt;/span&gt;]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    texts &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; instruction, input, output &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; zip(instructions, inputs, outputs):&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# Must add EOS_TOKEN, otherwise your generation will go on forever!&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        text &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; alpaca_prompt&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(instruction, input, output) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; EOS_TOKEN&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        texts&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(text)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; { &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt; : texts, }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;pass&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# 以上大部分内容都需要根据数据集修改以符合格式&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; datasets &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; load_dataset&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; load_dataset(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;yahma/alpaca-cleaned&amp;#34;&lt;/span&gt;, split &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;# 改为你要使用的数据集和Split&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dataset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dataset&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;map(formatting_prompts_func, batched &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;,)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;为了符合平日训练的需求，我将使用一个典型的SFT训练数据集来进行修改操作&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
